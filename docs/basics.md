# p5.pave2riso - 基本ガイド

## p5.pave2risoとは

p5.pave2risoは、ベクター図形から**リソグラフ印刷用の製版データ**を生成するライブラリです。

```
┌─────────────┐      ┌─────────────┐      ┌─────────────┐
│   Pave.js   │  →   │ p5.pave2riso│  →   │  p5.riso.js │
│  ベクター図形 │      │    変換     │      │ 製版データ＆プレビュー │
└─────────────┘      └─────────────┘      └─────────────┘
```

**主な用途：**
- リソグラフ印刷用の製版データ（グレースケール画像）を生成
- 印刷前のプレビューで仕上がりを確認
- クリエイティブコーディングでの版画的表現

---

## リソグラフ印刷とは

リソグラフは、1色ずつインクを重ねて刷る印刷方式です。

```
普通のカラー印刷              リソグラフ印刷
┌───────────────┐            ┌───────────────┐
│  CMYK が同時  │            │ 1色目: ピンク  │
│  に印刷される  │            │      ↓        │
│               │            │ 2色目: 青     │
│               │            │      ↓        │
│               │            │ 3色目: 黄色   │
└───────────────┘            └───────────────┘
```

**特徴：**
- 色が重なる部分は混ざって見える
- わずかなズレ（版ズレ）が味になる
- 限られた色数で豊かな表現

### 製版データとは

リソグラフで印刷するには、**色ごとに製版データ（グレースケール画像）** が必要です。

```
┌─────────────┐   ┌─────────────┐   ┌─────────────┐
│  ピンク版   │   │    青版     │   │   黄色版    │
│ (グレースケール) │   │ (グレースケール) │   │ (グレースケール) │
└─────────────┘   └─────────────┘   └─────────────┘
       ↓                 ↓                 ↓
    印刷機でピンク     印刷機で青      印刷機で黄色
    インクを刷る      インクを刷る     インクを刷る
```

p5.riso.jsの各チャンネルが、この製版データ（グレースケール画像）に相当します。
`drawRiso()` は、これらを重ねた**印刷プレビュー**を画面に表示します。

---

## 処理の流れ

p5.pave2risoは内部で以下の順序で処理を行います：

```
┌────────────────────────────────────────────────────┐
│                    pave2Riso()                     │
├────────────────────────────────────────────────────┤
│                                                    │
│   ① 検証                                          │
│      └→ パスやチャンネルが正しいか確認              │
│                                                    │
│   ② パイプライン初期化                             │
│      └→ 描画に必要な準備                           │
│                                                    │
│   ③ クリッピング（任意）                           │
│      └→ 描画範囲を限定                             │
│                                                    │
│   ④ モード処理                                     │
│      └→ cutout/joinの前処理                        │
│                                                    │
│   ⑤ 塗りつぶし描画                                 │
│      └→ solid/pattern/gradient/image               │
│                                                    │
│   ⑥ 線の描画                                       │
│      └→ solid/dashed/pattern/gradient              │
│                                                    │
│   ⑦ 後処理・解放                                   │
│      └→ メモリのクリーンアップ                      │
│                                                    │
└────────────────────────────────────────────────────┘
```

---

## 塗りつぶし（Fill）の種類

### 1. Solid（単色塗り）

最もシンプルな塗りつぶし。一色で均一に塗ります。

```
┌────────────┐
│████████████│
│████████████│  ← 単一の色で塗りつぶし
│████████████│
│████████████│
└────────────┘
```

### 2. Pattern（パターン塗り）

**p5.pattern.js** ライブラリを使用したパターン塗りです。

```
┌────────────┐     ┌────────────┐     ┌────────────┐
│║║║║║║║║║║║║│     │● ● ● ● ● ●│     │╱╱╱╱╱╱╱╱╱╱╱╱│
│║║║║║║║║║║║║│     │ ● ● ● ● ● │     │╱╱╱╱╱╱╱╱╱╱╱╱│
│║║║║║║║║║║║║│     │● ● ● ● ● ●│     │╱╱╱╱╱╱╱╱╱╱╱╱│
│║║║║║║║║║║║║│     │ ● ● ● ● ● │     │╱╱╱╱╱╱╱╱╱╱╱╱│
└────────────┘     └────────────┘     └────────────┘
  PTN.stripe         PTN.dot         PTN.stripe(45°)
```

**設定方法：**
```javascript
fill: {
  type: 'pattern',
  PTN: 'stripe',        // パターン名（p5.patternのPTNオブジェクト）
  patternArgs: [10],    // パターン関数への引数（間隔など）
  patternAngle: 45,     // 回転角度（度数法、省略可）
  channelVals: [100]
}
```

※ p5.pattern.jsの読み込みが必要です

### 3. Gradient（グラデーション塗り）

色が徐々に変化します。3種類のグラデーションタイプがあります。

```
linear（線形）          radial（放射）          conic（円錐）
┌────────────┐          ┌────────────┐          ┌────────────┐
│████████░░░░│          │░░░░░░░░░░░░│          │████▓▓░░░░██│
│████████░░░░│          │░░▓▓▓▓▓▓░░░░│          │██████▓▓░░░░│
│████████░░░░│          │░▓████████▓░│          │░░████████▓▓│
│████████░░░░│          │░░▓▓▓▓▓▓░░░░│          │▓▓░░░░██████│
└────────────┘          └────────────┘          └────────────┘
```

**線形グラデーションの方向（8種類）：**

| 値 | 方向 |
|----|------|
| `TD` | 上→下（Top to Down） |
| `DT` | 下→上（Down to Top） |
| `LR` | 左→右（Left to Right） |
| `RL` | 右→左（Right to Left） |
| `LTRB` | 左上→右下 |
| `RTLB` | 右上→左下 |
| `LBRT` | 左下→右上 |
| `RBLT` | 右下→左上 |

### 4. Image（画像塗り）

写真や画像で塗りつぶします。

```
┌────────────┐
│ ┌──────┐   │
│ │ 📷   │   │  ← 画像がパスの形で
│ │ 画像 │   │     切り抜かれる
│ └──────┘   │
└────────────┘
```

**fitオプション（画像の収め方）：**

| 値 | 動作 |
|----|------|
| `cover` | アスペクト比を保ち、領域全体をカバー（はみ出し切り取り） |
| `contain` | アスペクト比を保ち、領域内に収める（余白あり） |
| `fill` | 領域全体に引き伸ばす（比率変化） |
| `none` | 元のサイズのまま |

---

## 線（Stroke）の種類

### 1. Solid（実線）

```
──────────────────  ← 途切れのない線
```

### 2. Dashed（破線）

```
── ── ── ── ── ──  ← 線と空白が交互
```

### 3. Pattern（パターン線）

p5.pattern.jsを使用したパターン線です。

```
●─●─●─●─●─●─●─●─●  ← 模様のついた線
```

### 4. Gradient（グラデーション線）

```
████▓▓▓▓░░░░────  ← 色が変化する線
```

### 線の共通オプション

**cap（線端の形状）：**
| 値 | 形状 |
|----|------|
| `round` | 丸い端 |
| `square` | 四角い端 |
| `butt` | 切り落とし |

**join（角の形状）：**
| 値 | 形状 |
|----|------|
| `miter` | 尖った角 |
| `bevel` | 斜めにカット |
| `round` | 丸い角 |

---

## プリントモード

色の重なり方を制御します。

### Overprint（重ね刷り）- デフォルト

色をそのまま重ねます。重なった部分は混色します。

```
  青の円        ピンクの円      結果
    ○              ○          ○○
   ○○○            ○○○       ○○●○○  ← ●は混色部分
    ○              ○          ○○
```

### Cutout（くり抜き）

上に重ねる形を、下の色から削除してから印刷します。

```
Step 1: 青を印刷     Step 2: ピンク部分を削除   Step 3: ピンクを印刷
┌──────────────┐     ┌──────────────┐          ┌──────────────┐
│    ████      │     │    █  █      │          │    █○○█      │
│   ██████     │  →  │   ██  ██     │    →     │   ██○○██     │
│    ████      │     │    █  █      │          │    █○○█      │
└──────────────┘     └──────────────┘          └──────────────┘
                      ↑くり抜いた部分
```

**用途：** 色が混ざらないようにしたい時

### Join（結合）

インク濃度（Ink Density）を使って滑らかにつなげます。

```
青 100%濃度          ピンク 100%濃度
████████████        ○○○○○○○○○○○○

        ↓ Join処理

████████▓▓░░○○○○○○○○
        ↑グラデーション的に結合
```

**用途：** 滑らかな色の遷移を表現したい時

---

## 効果（Effects）

塗りや線に後処理を加えます。

### 処理順序

```
描画 → フィルター → ハーフトーン → ディザ
        (1)          (2)           (3)
```

### 1. フィルター

画像処理の効果を適用します。

| フィルター | 効果 | パラメータ |
|-----------|------|-----------|
| `blur` | ぼかし | radius（ピクセル数） |
| `posterize` | 色数を減らす（ポスター調） | levels（2-255） |
| `threshold` | 白黒に二値化 | threshold（0.0-1.0） |
| `gray` | グレースケール | - |
| `opaque` | 不透明化 | - |
| `invert` | 色を反転 | - |
| `dilate` | 膨張（太らせる） | - |
| `erode` | 収縮（細らせる） | - |

### 2. ハーフトーン

ドットパターンに変換します。印刷物のような質感が出ます。

```
Before                After（ハーフトーン）
┌──────────────┐      ┌──────────────┐
│██████████████│      │● ● ● ● ● ● ●│
│██████████████│  →   │ ● ● ● ● ● ● │
│██████████████│      │● ● ● ● ● ● ●│
│██████████████│      │ ● ● ● ● ● ● │
└──────────────┘      └──────────────┘
```

**設定方法：**
```javascript
halftone: {
  halftoneArgs: ['circle', 10]  // p5.riso.jsのhalftoneImage()に渡す引数
}
```
※ 引数はp5.riso.jsの仕様に従います

### 3. ディザ

誤差拡散で濃淡を表現します。写真的な表現に適しています。

```
Before（グラデーション）   After（ディザ）
┌──────────────┐          ┌──────────────┐
│████▓▓▓▓░░░░  │          │█▓█░▓░█░▓░░░ │
│████▓▓▓▓░░░░  │    →     │▓█░▓░█░░▓░ ░ │
│████▓▓▓▓░░░░  │          │█░▓░▓░░▓░ ░░ │
└──────────────┘          └──────────────┘
```

**設定方法：**
```javascript
dither: {
  ditherArgs: ['floydSteinberg', 128]  // p5.riso.jsのditherImage()に渡す引数
}
```
※ 引数はp5.riso.jsの仕様に従います

---

## 基本的な使用例

### シンプルな例

```javascript
// 1. パスを作成（Pave.js）
const circlePath = Path.circle(200, 200, 100)

// 2. チャンネル（色）を用意
const pink = p.riso.channels[0]

// 3. pave2Risoで描画
pave2Riso(circlePath, pink, {
  fill: {
    type: 'solid',
    channelVals: [100]  // インク濃度100%
  }
})
```

### 複数の効果を組み合わせる例

```javascript
pave2Riso(path, channel, {
  fill: {
    type: 'gradient',
    gradientType: 'linear',
    direction: 'LR',  // 左から右
    colorStops: [
      { position: 0, channelVals: [100] },
      { position: 1, channelVals: [0] }
    ]
  },
  halftone: {
    halftoneArgs: ['circle', 10]
  },
  mode: 'cutout'
})
```

---

## オプション一覧

| オプション | 説明 | 必須 |
|-----------|------|------|
| `fill` | 塗りつぶし設定 | △ |
| `stroke` | 線の設定 | △ |
| `mode` | プリントモード | × |
| `clip` | クリッピングパス | × |
| `filters` | フィルター配列 | × |
| `halftone` | ハーフトーン設定 | × |
| `dither` | ディザ設定 | × |

※ fillかstrokeのどちらかは必須

---

## 関連ドキュメント

- [ot2pave.md](ot2pave.md) - フォントをパスに変換する仕組み
- [api-reference.md](api-reference.md) - API詳細リファレンス
- [fill-types.md](fill-types.md) - 塗りつぶしの詳細
- [stroke-types.md](stroke-types.md) - 線の詳細
- [effects.md](effects.md) - 効果の詳細
- [modes.md](modes.md) - プリントモードの詳細
